# not actually YAML but lets pretend:
# -*- mode: yaml -*-
# vim: ft=yaml:

#server {
#  listen 443 ssl;
#  listen [::]:443 ssl;
#
#  server_name localhost:;

  # uncomment the following line to reject non-cloudflare connections, ensuring client IPs cannot be spoofed:
#  include cloudflare-only.conf;

#  location / {
    # recommendation: replace cpp_tcp with cpp_uds below
#    proxy_pass http://cpp_tcp;
#    proxy_redirect off;
    # disable buffering (next 4 lines)
#    proxy_http_version 1.1;
#    client_max_body_size 0;
#    proxy_buffering off;
#    proxy_request_buffering off;
    # improve download speed from 600 to 1500 MiB/s
#    proxy_buffers 32 8k;
#    proxy_buffer_size 16k;
#    proxy_busy_buffers_size 24k;

#    proxy_set_header   Connection        "Keep-Alive";
#    proxy_set_header   Host              $host;
#    proxy_set_header   X-Real-IP         $remote_addr;
#    proxy_set_header   X-Forwarded-Proto $scheme;
    # proxy_set_header   X-Forwarded-For   $proxy_add_x_forwarded_for;
    # NOTE: with cloudflare you want this X-Forwarded-For instead:
#    proxy_set_header   X-Forwarded-For   $http_cf_connecting_ip;
#  }
#}


# append some arguments to the commandline;
# accepts anything listed in --help (leading dashes are optional)
# and inline comments are OK if there is 2 spaces before the '#'
[global]
  nc: 256  # allow up to 256 active visitors
  urlform: save,get  # how to handle url-form POSTS; see --help-urlform
  wintitle: $ip-  # console prompt
  rm-retry: 20/0.5  # the number of seconds/retry-dely to remove a file if file removal fails
  mv-retry: 20/0.5  # the number of seconds/retry-dely to remove a file if file renaming fails
  dotpart  # dotfile incomplete uploads
  # plain-ip  # when avoiding filename collisions by appending the uploader's ip to the filename: append the plaintext ip instead of salting and hashing
  # xff-hdr: cf-connecting-ip
  unpost: 43200  # grace period for removing a file a user uploaded, regardless of their delete perms
  chmod-f: 644  # chmod perms for files
  chmod-d: 755  # chmod perms for directories
  magic  # enable filetype detection on nameless uploads
  df: 4  # ensure GiB free disk space by rejecting upload requests; assumes gigabytes
  write-uplog  # write POST reports to textfiles in working-directory
  p: 3939,8086  # listen on ports 3939 and 8086
  rp-loc: /vault  # if reverse-proxying on a location instead of a dedicated domain/subdomain, provide the base location here; example: [/foo/bar]
  https-only  # disable plaintext -- force tls
  chpw  # allow users to change their own passwords
  chpw-db: $XDG_CONFIG_PATH/.copyparty/chpw.json  # where to store passwords database
  chpw-len: 16  # minimum password length
  z  # enable all zeroconf backends
  nih  # no info hostname -- don't show in UI
  nb  # no powered-by-copyparty branding in the UI
  # zipmaxn: 256  # reject download-as-zip if more than N files in total
  zip-who: 2  # who can download as zip/tar? [0]=nobody, [1]=admins, [2]=authenticated-with-read-access, [3]=everyone-with-read-access (volflag=zip_who)
  no-pipe  # disable race-the-beam (lockstep download of files which are currently being uploaded)
  xvol  # never follow symlinks leaving the volume root, unless the link is into another volume where the user has similar access
  no-dot-mv  # disallow moving dotfiles; makes it impossible to move folders containing dotfiles
  no-dot-ren  # disallow renaming dotfiles; makes it impossible to turn something into a dotfile
  vague-403  # send 404 instead of 403 (security through ambiguity, very enterprise)
  force-js  # don't send folder listings as HTML, force clients to use the embedded json instead 
  no-robots  # adds http and html headers asking search engines to not index anything
  logout: 24  # logout clients after H hours of inactivity; [0.0028]=10sec, [0.1]=6min, [24]=day, [168]=week, [720]=month, [8760]=year)
  #ah-alg: argon2  # account-pw hashing algorithm; one of these, best to worst: argon2 scrypt sha2 none (each optionally followed by alg-specific comma-sep. config)
  dl-list: 1  # who can see active downloads in the controlpanel? [0]=nobody, [1]=admins, [2]=everyone
  ups-who: 1  # who can see recent uploads on the ?ru page? [0]=nobody, [1]=admins, [2]=everyone
  allow-wav
  allow-flac
  tail-who: 0  # who can tail? [0]=nobody, [1]=admins, [2]=authenticated-with-read-access, [3]=everyone-with-read-access
  srch-time: 30   # search deadline -- terminate searches running for more than SEC seconds
  srch-hits: 1000  # max search results to allow clients to fetch; 125 results will be shown initially
  name: filez
  e2dsa  # enable file indexing and filesystem scanning
  e2ts   # and enable multimedia indexing
  localtime  # default to local timezone

# create users:
[accounts]
  # username:password
  adminK: Im_on_fire_and_now_I_think_Im_ready  #A
  MamaKnipe: Through_the_looking_glass  
  PapaKnipe: Ggeezzer_Olentangy  
  SisKnipe: A_hug_is_always_the_right_size  #rwmd
  Lauren: Without_love_it_cannot_be_seen  #rwmd
  Rose: I_play_pot_of_greed_and_draw_3_cards  #rwmd
  Hank: A_small_hedgehog_in_a_space_helmet  #rwm
  Zach: For_the_emperor_who_has_everything  #rwm
  George: Some_fungi_are_only_edible_once  #rwm
  Ben: Pregnant_man_emoticon  #rwm
  Erin: Another_lens_to_view_the_world_through  #rwm
  Bill: One_hundred_huskies_with_GoPros  #rwm
  Kayleigh: Bomberman_fans_unite_baybee  #rwm
  Felicie: Tokyo_Mew_Mew_but_in_France  #rwm
  JoJo: Bah_Bah_Big_Sheep_et_cetera  #rwm
  Dawn: Jack_in_and_download_my_uwl  #rwm
  Chef: Media_for_free_wont_save_us_but
  Natalie: The_Black_Saint_and_the_Sinner_Lady  #rwmd
  Mike: I_still_cannot_believe_you_bought_me_that_bass  #rwmd
  Fart: Cats_to_the_second_power_and_power_tools  #rwmd
  Holly: Tell_your_wife_I_ALSO_enjoy_weed  #rwmd
  Mindset: Admin_on_the_frog_on_the_log_in_the_hole  #rwmd
  Maple: Im_smarter_than_I_think_I_am  #rwm
  NTO: My_GF13-049NM_Tequila_is_fight  #rwm
  Toto: Esoteric_Tarot_deck_reference  #rwm
  Dory: Unfortunately_not_miss_Fujisaki  #rwm
  Boss: The_emperor_will_not_be_left_on_read  #rwm
  Abdur: You_got_so_much_art_you_can_upload  #rwm
  Gragglebus1: Beep_beep_motherfucker_get_on  #rw
  Gragglebus2: Beep_booo_booo_bop_booo_booo_bop  #rw
  Gragglebus3: Is_this_a_long_enough_password  #rw
  Guest: a_password_longer_than_20_letters

[groups]
  family: MamaKnipe, PapaKnipe, SisKnipe, Lauren, Rose  # can be ultra-trusted, I think
  irls: Hank, Zach, George, Ben, Bill, Kayleigh, Erin  # my IRL friends
  cuties: Felicie, JoJo, Dawn  # the cuties
  yospos: Natalie, Mike, Fart, Holly, Mindset  # people I trust from YOSPOS
  graggle: Maple, NTO, Toto, Dory, Boss, Abdur  # people I trust from Graggle
  gragglepub: Gragglebus1, Gragglebus2, Gragglebus3  # public accounts I might give to graggle idk

# create volumes:
[/]         # create a volume at "/" (the webroot), which will
  /srv/www/vault/base         # share the contents of "." (the current directory)
  accs:
    g: *,-@acct
    r: @acct
    A: adminK  

# generic top-folder template
[/music]
  /run/media/kelli/storage1/music
  accs:
    A: adminK
    rwm: @acct
  flags:
    xvol  # don't follow symlinks leaving this volume
    mte: artist,title  #media-tags to index/display
    dvthumb  # disable video thumbnails
    notail  # disable downloading a growing file continuously

[/art]
  /run/media/kelli/storage1/art
  accs:
    A: adminK
    rwm: @acct
  flags:
    xvol  # don't follow symlinks leaving this volume
    mte: artist,title  #media-tags to index/display
    dvthumb  # disable video thumbnails
    notail  # disable downloading a growing file continuously

[/comics]
  /run/media/kelli/storage1/comics
  accs:
    A: adminK
    rwm: @acct
  flags:
    xvol  # don't follow symlinks leaving this volume
    mte: artist,title  #media-tags to index/display
    dvthumb  # disable video thumbnails
    notail  # disable downloading a growing file continuously

[/photos]
  /run/media/kelli/storage1/photos
  accs:
    A: adminK
    rwm: @acct
  flags:
    xvol  # don't follow symlinks leaving this volume
    mte: artist,title  #media-tags to index/display
    dvthumb  # disable video thumbnails
    notail  # disable downloading a growing file continuously

[/games]
  /run/media/kelli/storage2/games
  accs:
    A: adminK
    rwm: @acct
  flags:
    xvol  # don't follow symlinks leaving this volume
    mte: artist,title  #media-tags to index/display
    dvthumb  # disable video thumbnails
    notail  # disable downloading a growing file continuously

[/videos]
  /run/media/kelli/storage2/videos
  accs:
    A: adminK
    rwm: @acct
  flags:
    xvol  # don't follow symlinks leaving this volume
    mte: artist,title  #media-tags to index/display
    dvthumb  # disable video thumbnails
    notail  # disable downloading a growing file continuously
